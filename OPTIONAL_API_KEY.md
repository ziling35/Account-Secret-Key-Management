# API Key å¯é€‰åŠŸèƒ½è¯´æ˜Ž

## åŠŸèƒ½æ¦‚è¿°

çŽ°åœ¨ä¸Šä¼ è´¦å·æ—¶ï¼Œ**API Key å­—æ®µå˜ä¸ºå¯é€‰**ã€‚å¦‚æžœä¸Šä¼ çš„è´¦å·æ–‡ä»¶ä¸­æ²¡æœ‰ API Keyï¼Œç³»ç»Ÿä¼šåœ¨å®¢æˆ·ç«¯è¯·æ±‚èŽ·å–è´¦å·æ—¶ï¼Œè‡ªåŠ¨é€šè¿‡ç™»å½•èŽ·å– API Keyã€‚

## å·¥ä½œæµç¨‹

### 1. ä¸Šä¼ è´¦å·ï¼ˆAPI Key å¯é€‰ï¼‰

**æ”¯æŒçš„è´¦å·æ–‡ä»¶æ ¼å¼ï¼š**

#### æ ¼å¼ Aï¼šåŒ…å« API Keyï¼ˆä¼ ç»Ÿæ ¼å¼ï¼‰
```
Account 1:
  Email: user1@example.com
  Name: John Doe
  Password: password123
  API Key: sk-ws-01-xxxxx

Account 2:
  Email: user2@example.com
  Name: Jane Smith
  Password: password456
  API Key: sk-ws-01-yyyyy
```

#### æ ¼å¼ Bï¼šä¸åŒ…å« API Keyï¼ˆæ–°æ ¼å¼ï¼‰
```
Account 1:
  Email: user1@example.com
  Name: John Doe
  Password: password123

Account 2:
  Email: user2@example.com
  Name: Jane Smith
  Password: password456
```

#### æ ¼å¼ Cï¼šæ··åˆæ ¼å¼ï¼ˆéƒ¨åˆ†æœ‰ API Keyï¼‰
```
Account 1:
  Email: user1@example.com
  Name: John Doe
  Password: password123
  API Key: sk-ws-01-xxxxx

Account 2:
  Email: user2@example.com
  Name: Jane Smith
  Password: password456
```

### 2. è‡ªåŠ¨èŽ·å– API Key

å½“å®¢æˆ·ç«¯è¯·æ±‚èŽ·å–è´¦å·æ—¶ï¼š

1. **æ£€æŸ¥è´¦å·æ˜¯å¦æœ‰ API Key**
   - å¦‚æžœæœ‰ï¼šç›´æŽ¥è¿”å›žè´¦å·ä¿¡æ¯
   - å¦‚æžœæ²¡æœ‰ï¼šè‡ªåŠ¨æ‰§è¡Œç™»å½•æµç¨‹

2. **è‡ªåŠ¨ç™»å½•æµç¨‹**
   - ä½¿ç”¨è´¦å·çš„é‚®ç®±å’Œå¯†ç 
   - é€šè¿‡ Firebase è®¤è¯
   - è°ƒç”¨ Windsurf API èŽ·å– API Key
   - æ›´æ–°æ•°æ®åº“ä¸­çš„è´¦å·ä¿¡æ¯
   - è¿”å›žå®Œæ•´çš„è´¦å·ä¿¡æ¯ç»™å®¢æˆ·ç«¯

3. **é”™è¯¯å¤„ç†**
   - å¦‚æžœç™»å½•å¤±è´¥ï¼Œè¿”å›žé”™è¯¯ä¿¡æ¯
   - è´¦å·ä¿æŒæœªä½¿ç”¨çŠ¶æ€ï¼Œå¯ä»¥ç¨åŽé‡è¯•

## æ•°æ®åº“è¿ç§»

### è‡ªåŠ¨è¿ç§»

è¿è¡Œè¿ç§»è„šæœ¬æ›´æ–°æ•°æ®åº“ç»“æž„ï¼š

```bash
python migrate_api_key_optional.py
```

### æ‰‹åŠ¨è¿ç§»

#### PostgreSQL
```sql
ALTER TABLE accounts ALTER COLUMN api_key DROP NOT NULL;
ALTER TABLE accounts ALTER COLUMN name DROP NOT NULL;
```

#### SQLite
SQLite éœ€è¦é‡å»ºè¡¨ï¼ˆå‚è€ƒ migrate_api_key_optional.py è„šæœ¬ï¼‰

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šä¸Šä¼ ä¸å« API Key çš„è´¦å·

**è´¦å·æ–‡ä»¶ (accounts.txt):**
```
Account 1:
  Email: test1@example.com
  Name: Test User 1
  Password: testpass1

Account 2:
  Email: test2@example.com
  Name: Test User 2
  Password: testpass2
```

**ä¸Šä¼ ç»“æžœï¼š**
- âœ… è´¦å·æˆåŠŸå¯¼å…¥æ•°æ®åº“
- âš ï¸ API Key å­—æ®µä¸ºç©º
- ðŸ“ çŠ¶æ€ï¼šunusedï¼ˆæœªä½¿ç”¨ï¼‰

### ç¤ºä¾‹ 2ï¼šå®¢æˆ·ç«¯èŽ·å–è´¦å·

**å®¢æˆ·ç«¯è¯·æ±‚ï¼š**
```bash
curl -X POST "http://localhost:8000/api/client/account/get" \
  -H "X-API-Key: your_key_code"
```

**ç³»ç»Ÿå¤„ç†æµç¨‹ï¼š**
1. åˆ†é…ä¸€ä¸ªæœªä½¿ç”¨çš„è´¦å·ï¼ˆtest1@example.comï¼‰
2. æ£€æµ‹åˆ°è¯¥è´¦å·æ²¡æœ‰ API Key
3. è‡ªåŠ¨ç™»å½•ï¼š
   - ä½¿ç”¨ test1@example.com å’Œ testpass1
   - é€šè¿‡ Firebase è®¤è¯
   - èŽ·å– Windsurf API Key
4. æ›´æ–°æ•°æ®åº“ï¼š
   - ä¿å­˜èŽ·å–åˆ°çš„ API Key
   - æ›´æ–°è´¦å·çŠ¶æ€ä¸ºå·²ä½¿ç”¨
5. è¿”å›žå®Œæ•´è´¦å·ä¿¡æ¯

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "email": "test1@example.com",
  "api_key": "sk-ws-01-xxxxxxxxxx",
  "password": "testpass1",
  "name": "Test User 1"
}
```

### ç¤ºä¾‹ 3ï¼šç™»å½•å¤±è´¥å¤„ç†

å¦‚æžœè‡ªåŠ¨ç™»å½•å¤±è´¥ï¼ˆå¯†ç é”™è¯¯ã€ç½‘ç»œé—®é¢˜ç­‰ï¼‰ï¼š

**é”™è¯¯å“åº”ï¼š**
```json
{
  "detail": "è´¦å· API Key èŽ·å–å¤±è´¥: å¯†ç é”™è¯¯"
}
```

**ç³»ç»Ÿè¡Œä¸ºï¼š**
- è´¦å·ä¿æŒ unused çŠ¶æ€
- ä¸è®¡å…¥å¯†é’¥ä½¿ç”¨æ¬¡æ•°
- ä¸‹æ¬¡è¯·æ±‚ä¼šå°è¯•åˆ†é…å…¶ä»–è´¦å·

## ä¼˜åŠ¿

### 1. ç®€åŒ–è´¦å·ç®¡ç†
- ä¸éœ€è¦é¢„å…ˆèŽ·å–æ‰€æœ‰è´¦å·çš„ API Key
- åªéœ€è¦é‚®ç®±å’Œå¯†ç å³å¯ä¸Šä¼ 
- å‡å°‘è´¦å·å‡†å¤‡å·¥ä½œ

### 2. æŒ‰éœ€èŽ·å–
- API Key åœ¨å®žé™…ä½¿ç”¨æ—¶æ‰èŽ·å–
- é¿å…æå‰èŽ·å–å¯¼è‡´çš„è¿‡æœŸé—®é¢˜
- èŠ‚çœ API è°ƒç”¨æ¬¡æ•°

### 3. çµæ´»æ€§
- æ”¯æŒæ··åˆæ ¼å¼ï¼ˆéƒ¨åˆ†æœ‰ API Keyï¼Œéƒ¨åˆ†æ²¡æœ‰ï¼‰
- å…¼å®¹æ—§çš„è´¦å·æ–‡ä»¶æ ¼å¼
- å¹³æ»‘å‡çº§ï¼Œæ— éœ€ä¿®æ”¹çŽ°æœ‰æ•°æ®

### 4. è‡ªåŠ¨åŒ–
- å…¨è‡ªåŠ¨èŽ·å–æµç¨‹
- æ— éœ€äººå·¥å¹²é¢„
- å¤±è´¥è‡ªåŠ¨é‡è¯•ï¼ˆä¸‹æ¬¡è¯·æ±‚ï¼‰

## æ³¨æ„äº‹é¡¹

### 1. é¦–æ¬¡ä½¿ç”¨å»¶è¿Ÿ
- æ²¡æœ‰ API Key çš„è´¦å·é¦–æ¬¡ä½¿ç”¨æ—¶éœ€è¦é¢å¤– 2-5 ç§’
- ç”¨äºŽæ‰§è¡Œç™»å½•å’ŒèŽ·å– API Key
- åŽç»­ä½¿ç”¨æ— å»¶è¿Ÿ

### 2. å¯†ç æ­£ç¡®æ€§
- ç¡®ä¿ä¸Šä¼ çš„å¯†ç æ­£ç¡®
- å¯†ç é”™è¯¯ä¼šå¯¼è‡´ API Key èŽ·å–å¤±è´¥
- å»ºè®®åœ¨ä¸Šä¼ å‰éªŒè¯è´¦å·å¯†ç 

### 3. ç½‘ç»œä¾èµ–
- è‡ªåŠ¨èŽ·å–éœ€è¦è®¿é—® Firebase å’Œ Windsurf API
- ç¡®ä¿æœåŠ¡å™¨ç½‘ç»œæ­£å¸¸
- ç½‘ç»œé—®é¢˜ä¼šå¯¼è‡´èŽ·å–å¤±è´¥

### 4. æ•°æ®åº“è¿ç§»
- å‡çº§å‰éœ€è¦è¿è¡Œè¿ç§»è„šæœ¬
- å»ºè®®å…ˆå¤‡ä»½æ•°æ®åº“
- è¿ç§»è¿‡ç¨‹ä¸­æœåŠ¡ä¼šçŸ­æš‚ä¸­æ–­

## æ•…éšœæŽ’æŸ¥

### é—®é¢˜ 1ï¼šè¿ç§»å¤±è´¥

**ç—‡çŠ¶ï¼š**
```
sqlalchemy.exc.IntegrityError: NOT NULL constraint failed
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®ä¿å·²è¿è¡Œè¿ç§»è„šæœ¬
2. æ£€æŸ¥æ•°æ®åº“è¿žæŽ¥
3. æ‰‹åŠ¨æ‰§è¡Œ SQL è¿ç§»

### é—®é¢˜ 2ï¼šAPI Key èŽ·å–å¤±è´¥

**ç—‡çŠ¶ï¼š**
```
è´¦å· API Key èŽ·å–å¤±è´¥: å¯†ç é”™è¯¯
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. éªŒè¯è´¦å·å¯†ç æ˜¯å¦æ­£ç¡®
2. åœ¨ Windsurf å®˜ç½‘æµ‹è¯•ç™»å½•
3. æ£€æŸ¥ç½‘ç»œè¿žæŽ¥
4. æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—

### é—®é¢˜ 3ï¼šè´¦å·ä¸€ç›´å¤„äºŽ unused çŠ¶æ€

**ç—‡çŠ¶ï¼š**
- è´¦å·è¢«åˆ†é…ä½†çŠ¶æ€æœªæ›´æ–°

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—
2. ç¡®è®¤ API Key èŽ·å–æˆåŠŸ
3. æ£€æŸ¥æ•°æ®åº“äº‹åŠ¡æ˜¯å¦æäº¤

## é…ç½®é€‰é¡¹

### çŽ¯å¢ƒå˜é‡

```env
# Firebase API Keyï¼ˆå¯é€‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨èŽ·å–ï¼‰
FIREBASE_API_KEY=AIzaSyXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
```

### è¶…æ—¶è®¾ç½®

åœ¨ `app/windsurf_login.py` ä¸­å¯ä»¥è°ƒæ•´è¶…æ—¶æ—¶é—´ï¼š

```python
self.client = httpx.AsyncClient(timeout=30.0)  # é»˜è®¤ 30 ç§’
```

## æµ‹è¯•

### æµ‹è¯•è´¦å·ä¸Šä¼ 

```bash
# åˆ›å»ºæµ‹è¯•è´¦å·æ–‡ä»¶
cat > test_accounts.txt << EOF
Account 1:
  Email: test@example.com
  Name: Test User
  Password: testpass123
EOF

# ä¸Šä¼ è´¦å·
curl -X POST "http://localhost:8000/admin/api/accounts/upload" \
  -H "Cookie: admin_session=your_session" \
  -F "files=@test_accounts.txt"
```

### æµ‹è¯•è‡ªåŠ¨èŽ·å–

```bash
# èŽ·å–è´¦å·ï¼ˆä¼šè‡ªåŠ¨èŽ·å– API Keyï¼‰
curl -X POST "http://localhost:8000/api/client/account/get" \
  -H "X-API-Key: your_key_code"
```

## æ›´æ–°æ—¥å¿—

### v1.2.0 - 2024-12-09

- âœ¨ API Key å­—æ®µå˜ä¸ºå¯é€‰
- âœ¨ è‡ªåŠ¨ç™»å½•èŽ·å– API Key
- âœ¨ æ”¯æŒæ··åˆæ ¼å¼è´¦å·æ–‡ä»¶
- ðŸ”§ æ•°æ®åº“ç»“æž„æ›´æ–°
- ðŸ“ æ–°å¢žè¿ç§»è„šæœ¬

## ç›¸å…³æ–‡æ¡£

- [ç™»å½•åŠŸèƒ½è¯´æ˜Ž](LOGIN_FEATURE.md)
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](QUICK_START_LOGIN.md)
- [æ›´æ–°æ—¥å¿—](CHANGELOG.md)
