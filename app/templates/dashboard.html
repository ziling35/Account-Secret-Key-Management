{% extends "base.html" %}

{% block title %}仪表盘 - Windsurf账号池管理系统{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title"><i class="bi bi-speedometer2"></i> 数据统计</h1>
    <div style="display: flex; gap: 20px; align-items: center;">
        <div style="text-align: center; padding: 8px 16px; background: #f0f9ff; border-radius: 8px; border: 1px solid #bae6fd;">
            <div style="font-size: 0.75rem; color: #0369a1; margin-bottom: 4px;">账号使用率</div>
            <div style="font-size: 1.25rem; font-weight: 600; color: #0284c7;">
                {% if stats.total_accounts > 0 %}
                    {{ "%.1f"|format((stats.used_accounts / stats.total_accounts * 100)) }}%
                {% else %}
                    0%
                {% endif %}
            </div>
        </div>
        <div style="text-align: center; padding: 8px 16px; background: #fef3c7; border-radius: 8px; border: 1px solid #fde68a;">
            <div style="font-size: 0.75rem; color: #d97706; margin-bottom: 4px;">密钥激活率</div>
            <div style="font-size: 1.25rem; font-weight: 600; color: #f59e0b;">
                {% if stats.total_keys > 0 %}
                    {{ "%.1f"|format(((stats.active_keys + stats.expired_keys) / stats.total_keys * 100)) }}%
                {% else %}
                    0%
                {% endif %}
            </div>
        </div>
        <div style="text-align: center; padding: 8px 16px; background: #fce7f3; border-radius: 8px; border: 1px solid #f9a8d4;">
            <div style="font-size: 0.75rem; color: #be185d; margin-bottom: 4px;">待获取账号需求</div>
            <div style="font-size: 1.25rem; font-weight: 600; color: #db2777;">
                {{ stats.pending_account_demand }}
            </div>
        </div>
        <div style="text-align: center; padding: 8px 16px; background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); border-radius: 8px; border: 1px solid #c084fc;">
            <div style="font-size: 0.75rem; color: #7c3aed; margin-bottom: 4px;">Pro 号池</div>
            <div style="font-size: 1.25rem; font-weight: 600; color: #8b5cf6;">
                {{ stats.unused_pro_accounts }}/{{ stats.total_pro_accounts }}
            </div>
        </div>
    </div>
</div>

<!-- 账号统计 -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">总账号数</div>
        <div class="stat-value">{{ stats.total_accounts }}</div>
        <i class="bi bi-people-fill stat-icon"></i>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">可用账号</div>
        <div class="stat-value" style="color: #27ae60;">{{ stats.unused_accounts }}</div>
        <i class="bi bi-check-circle stat-icon"></i>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">已使用</div>
        <div class="stat-value" style="color: #95a5a6;">{{ stats.used_accounts }}</div>
        <i class="bi bi-x-circle stat-icon"></i>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">已过期</div>
        <div class="stat-value" style="color: #e74c3c;">{{ stats.expired_accounts }}</div>
        <i class="bi bi-exclamation-triangle stat-icon"></i>
    </div>
</div>

<!-- 密钥统计 -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-label">总密钥数</div>
        <div class="stat-value">{{ stats.total_keys }}</div>
        <i class="bi bi-key-fill stat-icon"></i>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">未激活</div>
        <div class="stat-value" style="color: #f39c12;">{{ stats.inactive_keys }}</div>
        <i class="bi bi-clock stat-icon"></i>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">已激活</div>
        <div class="stat-value" style="color: #27ae60;">{{ stats.active_keys }}</div>
        <i class="bi bi-check2-circle stat-icon"></i>
    </div>
    
    <div class="stat-card">
        <div class="stat-label">已过期</div>
        <div class="stat-value" style="color: #e74c3c;">{{ stats.expired_keys }}</div>
        <i class="bi bi-exclamation-circle stat-icon"></i>
    </div>
</div>

<!-- Pro 账号统计 -->
<div class="content-card" style="margin-top: 20px;">
    <div style="padding: 15px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px 8px 0 0;">
        <h4 style="margin: 0; color: white;"><i class="bi bi-star-fill"></i> Pro 账号池统计</h4>
    </div>
    <div style="padding: 20px;">
        <div class="stats-grid" style="margin-bottom: 15px;">
            <div class="stat-card" style="border-left: 4px solid #667eea;">
                <div class="stat-label">Pro 总账号</div>
                <div class="stat-value" style="color: #667eea;">{{ stats.total_pro_accounts }}</div>
                <i class="bi bi-people-fill stat-icon" style="color: #667eea;"></i>
            </div>
            
            <div class="stat-card" style="border-left: 4px solid #27ae60;">
                <div class="stat-label">Pro 可用</div>
                <div class="stat-value" style="color: #27ae60;">{{ stats.unused_pro_accounts }}</div>
                <i class="bi bi-check-circle stat-icon" style="color: #27ae60;"></i>
            </div>
            
            <div class="stat-card" style="border-left: 4px solid #95a5a6;">
                <div class="stat-label">Pro 已使用</div>
                <div class="stat-value" style="color: #95a5a6;">{{ stats.used_pro_accounts }}</div>
                <i class="bi bi-x-circle stat-icon" style="color: #95a5a6;"></i>
            </div>
            
            <div class="stat-card" style="border-left: 4px solid #e74c3c;">
                <div class="stat-label">Pro 已过期</div>
                <div class="stat-value" style="color: #e74c3c;">{{ stats.expired_pro_accounts }}</div>
                <i class="bi bi-exclamation-triangle stat-icon" style="color: #e74c3c;"></i>
            </div>
        </div>
        
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <div style="flex: 1; min-width: 200px; text-align: center; padding: 15px; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); border-radius: 8px;">
                <div style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">Pro 密钥总数</div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #764ba2;">{{ stats.total_pro_keys }}</div>
            </div>
            <div style="flex: 1; min-width: 200px; text-align: center; padding: 15px; background: linear-gradient(135deg, #e0f7fa 0%, #80deea 100%); border-radius: 8px;">
                <div style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">活跃 Pro 密钥</div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #00796b;">{{ stats.active_pro_keys }}</div>
            </div>
            <div style="flex: 1; min-width: 200px; text-align: center; padding: 15px; background: linear-gradient(135deg, #fff3e0 0%, #ffcc80 100%); border-radius: 8px;">
                <div style="font-size: 0.85rem; color: #666; margin-bottom: 8px;">Pro 号池使用率</div>
                <div style="font-size: 1.5rem; font-weight: 700; color: #e65100;">
                    {% if stats.total_pro_accounts > 0 %}
                        {{ "%.1f"|format((stats.used_pro_accounts / stats.total_pro_accounts * 100)) }}%
                    {% else %}
                        0%
                    {% endif %}
                </div>
            </div>
        </div>
        
        {% set pro_pool_health = stats.unused_pro_accounts - stats.pending_pro_demand %}
        <div style="margin-top: 15px; padding: 15px; border-radius: 8px; {% if pro_pool_health >= 10 %}background: #dcfce7; border: 1px solid #86efac;{% elif pro_pool_health >= 0 %}background: #fef9c3; border: 1px solid #fde047;{% else %}background: #fee2e2; border: 1px solid #fca5a5;{% endif %}">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                <div>
                    <strong style="{% if pro_pool_health >= 10 %}color: #166534;{% elif pro_pool_health >= 0 %}color: #a16207;{% else %}color: #dc2626;{% endif %}">
                        <i class="bi bi-{% if pro_pool_health >= 10 %}check-circle{% elif pro_pool_health >= 0 %}exclamation-triangle{% else %}x-circle{% endif %}"></i>
                        Pro 号池健康度
                    </strong>
                </div>
                <div style="{% if pro_pool_health >= 10 %}color: #15803d;{% elif pro_pool_health >= 0 %}color: #ca8a04;{% else %}color: #b91c1c;{% endif %}">
                    待获取需求 <strong>{{ stats.pending_pro_demand }}</strong> | 
                    可用 <strong>{{ stats.unused_pro_accounts }}</strong> | 
                    {% if pro_pool_health >= 0 %}
                        盈余 <strong>{{ pro_pool_health }}</strong>
                    {% else %}
                        <strong style="color: #dc2626;">透支 {{ pro_pool_health|abs }}，请补充Pro号池！</strong>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 系统状态 -->
<div class="content-card">
    <div style="padding: 20px; background: #eff6ff; border: 1px solid #bfdbfe; border-radius: 8px; margin-bottom: 15px;">
        <h4 style="margin-bottom: 10px; color: #1e40af;"><i class="bi bi-info-circle"></i> 系统状态</h4>
        <p style="margin: 0; color: #1e3a8a;">
            系统运行正常 | 可用账号 <strong>{{ stats.unused_accounts }}</strong> 个 | 活跃密钥 <strong>{{ stats.active_keys }}</strong> 个
        </p>
    </div>
    {% set pool_health = stats.unused_accounts - stats.pending_account_demand %}
    <div style="padding: 20px; border-radius: 8px; {% if pool_health >= 50 %}background: #dcfce7; border: 1px solid #86efac;{% elif pool_health >= 0 %}background: #fef9c3; border: 1px solid #fde047;{% else %}background: #fee2e2; border: 1px solid #fca5a5;{% endif %}">
        <h4 style="margin-bottom: 10px; {% if pool_health >= 50 %}color: #166534;{% elif pool_health >= 0 %}color: #a16207;{% else %}color: #dc2626;{% endif %}">
            <i class="bi bi-{% if pool_health >= 50 %}check-circle{% elif pool_health >= 0 %}exclamation-triangle{% else %}x-circle{% endif %}"></i> 号池健康度
        </h4>
        <p style="margin: 0; {% if pool_health >= 50 %}color: #15803d;{% elif pool_health >= 0 %}color: #ca8a04;{% else %}color: #b91c1c;{% endif %}">
            待获取账号需求 <strong>{{ stats.pending_account_demand }}</strong> 个 | 
            可用账号 <strong>{{ stats.unused_accounts }}</strong> 个 | 
            {% if pool_health >= 0 %}
                盈余 <strong>{{ pool_health }}</strong> 个
            {% else %}
                <strong style="color: #dc2626;">透支 {{ pool_health|abs }} 个，请及时补充号池！</strong>
            {% endif %}
        </p>
    </div>
</div>
{% endblock %}
